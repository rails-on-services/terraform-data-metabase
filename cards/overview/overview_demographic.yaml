---
overview_demographic:
  name: Overview - Demographic
  description: Total active customer month wise for graph. Managed by Terraform.
  native_query: |2
    WITH date_filter AS (
        SELECT
            TIMESTAMP(FORMAT_TIMESTAMP("%Y-%m-%d %H:%M:%S", {{start_date}}), {{timezone}}) AS start_date,
            TIMESTAMP_ADD(TIMESTAMP(FORMAT_TIMESTAMP("%Y-%m-%d %H:%M:%S", {{end_date}}), {{timezone}}), INTERVAL 24 HOUR) AS end_date
    )
    SELECT
        CASE
            WHEN DATE_DIFF(CURRENT_DATE(), user_account.birthday, YEAR) < 18 THEN '18-'
            WHEN DATE_DIFF(CURRENT_DATE(), user_account.birthday, YEAR) BETWEEN 18 AND 24 THEN '18-24'
            WHEN DATE_DIFF(CURRENT_DATE(), user_account.birthday, YEAR) BETWEEN 25 AND 34 THEN '25-34'
            WHEN DATE_DIFF(CURRENT_DATE(), user_account.birthday, YEAR) BETWEEN 35 AND 44 THEN '35-44'
            WHEN DATE_DIFF(CURRENT_DATE(), user_account.birthday, YEAR) BETWEEN 45 AND 54 THEN '45-54'
            WHEN DATE_DIFF(CURRENT_DATE(), user_account.birthday, YEAR) BETWEEN 56 AND 64 THEN '56-64'
            WHEN DATE_DIFF(CURRENT_DATE(), user_account.birthday, YEAR) > 65 THEN '65+'
            ELSE 'Unknown'
        END AS `age`,
        gender,
        count
       -- COUNT(*) AS `count`
    FROM
        ( SELECT 'digi_digi' as tenant, timestamp('2019-08-12 14:45:55 UTC') as time,'1221323' user_identifier
          union all
         SELECT 'digi_digi' as tenant, timestamp('2019-08-10 14:45:55 UTC') as time,'1221783' user_identifier
        )  http_log_reward_show, date_filter
        LEFT JOIN (
        select 'digi_digi' as tenant ,date('1995-01-21') as birthday,'1221783' as identifier,'male' gender, 12344 count
        union all
        select 'digi_digi' as tenant ,date('1995-01-21') as birthday,'1221783' as identifier,'female' gender, 18344 count
        union all
        select 'digi_digi' as tenant ,date('1985-04-18') as birthday,'1221323'as identifier, 'female' gender, 10344 count
         union all
         select 'digi_digi' as tenant ,date('1985-04-18') as birthday,'1221323'as identifier, 'male' gender, 20344 count
         union all
        select 'digi_digi' as tenant ,date('1975-04-18') as birthday,'1221323'as identifier, 'female' gender, 9344 count
          union all
        select 'digi_digi' as tenant ,date('1975-04-18') as birthday,'1221323'as identifier, 'male' gender, 26344 count
             union all
        select 'digi_digi' as tenant ,date('1965-04-18') as birthday,'1221323'as identifier, 'female' gender, 8344 count
          union all
        select 'digi_digi' as tenant ,date('1965-04-18') as birthday,'1221323'as identifier, 'male' gender, 14344 count
        union all
        select 'digi_digi' as tenant ,date('1955-04-18') as birthday,'1221323'as identifier, 'female' gender, 12344 count
          union all
        select 'digi_digi' as tenant ,date('1955-04-18') as birthday,'1221323'as identifier, 'male' gender, 12344 count
        ) user_account ON user_account.identifier=http_log_reward_show.user_identifier AND (user_account.tenant={{tenant}} or 1=1)
    WHERE (http_log_reward_show.tenant={{tenant}}  OR 1=1)
        AND http_log_reward_show.time >= date_filter.start_date
        AND http_log_reward_show.time <= date_filter.end_date
    --GROUP BY 1
    ORDER BY 1
  variables:
  - name: start_date
    type: date
    display_name: Start Date
    required: true
    default: null
    embedding_param: enabled
  - name: end_date
    type: date
    display_name: End Date
    required: true
    default: null
    embedding_param: enabled
  - name: timezone
    type: text
    display_name: Timezone
    required: true
    default: Asia/Singapore
    embedding_param: enabled
  - name: tenant
    type: text
    display_name: Tenant
    required: true
    default: null
    embedding_param: locked
  database_id: ${database_id}
  enable_embedding: true
